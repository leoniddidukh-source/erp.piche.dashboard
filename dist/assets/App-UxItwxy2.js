import{d as o}from"./dashboardModule__loadShare__react__loadShare__-BSltgMu-.js";var Y={exports:{}},I={};var ae=Symbol.for("react.transitional.element"),ie=Symbol.for("react.fragment");function G(l,s,r){var m=null;if(r!==void 0&&(m=""+r),s.key!==void 0&&(m=""+s.key),"key"in s){r={};for(var d in s)d!=="key"&&(r[d]=s[d])}else r=s;return s=r.ref,{$$typeof:ae,type:l,key:m,ref:s!==void 0?s:null,props:r}}I.Fragment=ie;I.jsx=G;I.jsxs=G;Y.exports=I;var t=Y.exports;const q=o.createContext(void 0),U="dashboard.theme";function ue({children:l}){const[s,r]=o.useState(()=>{if(typeof window>"u")return"dark";const d=localStorage.getItem(U);return d==="light"||d==="dark"?d:window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"});o.useEffect(()=>{document.documentElement.setAttribute("data-theme",s),localStorage.setItem(U,s)},[s]);const m=()=>{r(d=>d==="light"?"dark":"light")};return t.jsx(q.Provider,{value:{theme:s,toggleTheme:m},children:l})}function z(){const l=o.useContext(q);if(l===void 0)throw new Error("useTheme must be used within a ThemeProvider");return l}function le(){const{theme:l,toggleTheme:s}=z();return t.jsx("button",{className:"theme-toggle",onClick:s,"aria-label":`Switch to ${l==="light"?"dark":"light"} mode`,title:`Switch to ${l==="light"?"dark":"light"} mode`,children:t.jsx("svg",{className:"theme-toggle-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l==="light"?t.jsx(t.Fragment,{children:t.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):t.jsxs(t.Fragment,{children:[t.jsx("circle",{cx:"12",cy:"12",r:"5"}),t.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),t.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),t.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),t.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),t.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),t.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),t.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),t.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})})})}const b={shapes:"dashboard.whiteboard.shapes",history:"dashboard.whiteboard.history",user:"dashboard.whiteboard.user"},E=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).slice(2,11),$=(l,s,r)=>Math.min(Math.max(l,s),r),H=(l,s)=>{if(typeof window>"u")return s;try{const r=window.localStorage.getItem(l);return r?JSON.parse(r):s}catch(r){return console.warn(`Failed to read ${l} from storage`,r),s}},L=(l,s)=>{if(!(typeof window>"u"))try{window.localStorage.setItem(l,JSON.stringify(s))}catch(r){console.warn(`Failed to save ${l} in storage`,r)}},ce=l=>new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(l);function de(){const{theme:l}=z(),s=o.useMemo(()=>E(),[]),[r,m]=o.useState(()=>{const e=H(b.user,"");return e||`Guest-${Math.floor(Math.random()*900+100)}`}),[d,J]=o.useState("pen"),[x,X]=o.useState("#22d3ee"),[j,Q]=o.useState(4),[f,p]=o.useState(()=>H(b.shapes,[])),[u,g]=o.useState(()=>H(b.history,[])),[R,F]=o.useState(!1),[C,_]=o.useState([]),[c,v]=o.useState(null),B=o.useRef(null),D=o.useRef(null),M=o.useRef(null),P=o.useRef(f),A=o.useRef(u);o.useEffect(()=>{P.current=f,L(b.shapes,f)},[f]),o.useEffect(()=>{A.current=u,L(b.history,u)},[u]),o.useEffect(()=>{L(b.user,r)},[r]),o.useEffect(()=>{if(typeof window>"u")return;const e=new BroadcastChannel("dashboard-whiteboard");M.current=e;const n=a=>{const i=a.data;if(!(!i||i.senderId===s))switch(i.kind){case"add-shape":p(h=>[...h,i.shape]),g(h=>[i.history,...h]);break;case"clear-board":p([]),g(h=>[i.history,...h]);break;case"sync-request":if(!P.current.length&&!A.current.length)return;e.postMessage({kind:"sync-state",shapes:P.current,history:A.current,senderId:s});break;case"sync-state":p(i.shapes),g(i.history);break;case"remove-history":g(h=>h.filter(T=>T.id!==i.historyId)),i.shapeId&&p(h=>h.filter(T=>T.id!==i.shapeId));break}};return e.addEventListener("message",n),e.postMessage({kind:"sync-request",senderId:s}),()=>{e.removeEventListener("message",n),e.close()}},[s]);const k=o.useCallback(e=>{M.current?.postMessage(e)},[M]),W=o.useCallback((e,n,a)=>{const i={id:E(),timestamp:Date.now(),user:n??r,description:e,shapeId:a};return g(h=>[i,...h].slice(0,250)),i},[r]),w=o.useCallback((e,n)=>{const a=W(n,void 0,e.id);p(i=>[...i,e]),k({kind:"add-shape",shape:e,history:a,senderId:s})},[k,s,W]),N=o.useCallback((e,n)=>{if(!e.trim()){v(null);return}const a={id:E(),type:"text",createdAt:Date.now(),createdBy:r,x:n.x,y:n.y,text:e.trim(),color:x};w(a,`${r} added text "${a.text}"`),v(null)},[x,w,r]),S=o.useCallback(()=>{v(null)},[]);o.useEffect(()=>{c&&D.current&&D.current.focus()},[c]);const V=o.useCallback(e=>{d==="text"&&e!=="text"&&c&&(c.value.trim()?N(c.value,c.position):S()),J(e)},[d,c,N,S]),Z=o.useCallback(e=>{if(e.length<2)return;const n={id:E(),type:"path",createdAt:Date.now(),createdBy:r,points:e,stroke:x,strokeWidth:j};w(n,`${r} drew a stroke (${e.length} pts)`)},[x,w,j,r]),O=e=>{const n=B.current;if(!n)return null;const a=n.getBoundingClientRect();return{x:$(e.clientX-a.left,0,a.width),y:$(e.clientY-a.top,0,a.height)}},K=e=>{if(e.target.classList.contains("board-text-input"))return;const n=O(e);if(n){if(c){c.value.trim()?N(c.value,c.position):S(),e.preventDefault();return}if(d==="pen"){_([n]),F(!0),e.currentTarget.setPointerCapture(e.pointerId),e.preventDefault();return}if(d==="text"){v({position:n,value:""}),e.preventDefault();return}if(d==="table"){const a=Number(window.prompt("How many rows? (1-12)","3"))||0,i=Number(window.prompt("How many columns? (1-12)","4"))||0;if(!a||!i)return;const h={id:E(),type:"table",createdAt:Date.now(),createdBy:r,x:n.x,y:n.y,rows:$(a,1,12),cols:$(i,1,12),cellWidth:80,cellHeight:40,stroke:x};w(h,`${r} created a ${h.rows}x${h.cols} table`)}}},ee=e=>{if(!R||d!=="pen")return;const n=O(e);n&&_(a=>[...a,n])},te=()=>{R&&(C.length>=2&&Z(C),_([]),F(!1))},se=()=>{if(!f.length)return;const e=W(`${r} cleared the board`);p([]),k({kind:"clear-board",history:e,senderId:s})},re=o.useCallback(e=>{const n=u.find(a=>a.id===e);g(a=>a.filter(i=>i.id!==e)),n?.shapeId&&p(a=>a.filter(i=>i.id!==n.shapeId)),k({kind:"remove-history",historyId:e,shapeId:n?.shapeId,senderId:s})},[k,s,u]),ne=e=>{switch(e.type){case"path":return t.jsx("polyline",{className:"path-stroke",points:e.points.map(n=>`${n.x},${n.y}`).join(" "),stroke:e.stroke,strokeWidth:e.strokeWidth,strokeLinecap:"round",strokeLinejoin:"round",fill:"none",opacity:.85},e.id);case"text":return t.jsx("text",{x:e.x,y:e.y,fill:e.color,className:"board-text",children:e.text},e.id);case"table":{const n=e.cols*e.cellWidth,a=e.rows*e.cellHeight,i=Array.from({length:e.rows-1},(T,y)=>t.jsx("line",{x1:e.x,y1:e.y+e.cellHeight*(y+1),x2:e.x+n,y2:e.y+e.cellHeight*(y+1),stroke:e.stroke,strokeWidth:1,opacity:.6},`${e.id}-h-${y}`)),h=Array.from({length:e.cols-1},(T,y)=>t.jsx("line",{x1:e.x+e.cellWidth*(y+1),y1:e.y,x2:e.x+e.cellWidth*(y+1),y2:e.y+a,stroke:e.stroke,strokeWidth:1,opacity:.6},`${e.id}-v-${y}`));return t.jsxs("g",{className:"board-table",children:[t.jsx("rect",{x:e.x,y:e.y,width:n,height:a,fill:l==="light"?"rgba(241, 245, 249, 0.3)":"rgba(15, 23, 42, 0.25)",stroke:e.stroke,strokeWidth:1.5,rx:4}),i,h]},e.id)}default:return null}},oe={pen:"Drawing",text:"Text",table:"Table"}[d];return t.jsxs("div",{className:"app-shell",children:[t.jsxs("header",{className:"top-bar",children:[t.jsxs("div",{children:[t.jsx("p",{className:"app-eyebrow",children:"Realtime dashboard"}),t.jsx("h1",{children:"Collaborative Whiteboard"}),t.jsx("p",{className:"app-subtitle",children:"Draw with teammates, drop quick notes, build lightweight tables, and track every interaction in the activity stream."})]}),t.jsxs("div",{className:"user-badge",children:[t.jsx("label",{htmlFor:"userName",children:"Display name"}),t.jsx("input",{id:"userName",value:r,onChange:e=>m(e.target.value.slice(0,32)),placeholder:"Your name"})]}),t.jsx(le,{})]}),t.jsxs("section",{className:"content",children:[t.jsxs("aside",{className:"panel tool-panel",children:[t.jsx("p",{className:"panel-title",children:"Create"}),t.jsx("div",{className:"tool-grid",children:["pen","text","table"].map(e=>t.jsxs("button",{className:`tool-btn ${d===e?"active":""}`,onClick:()=>V(e),children:[e==="pen"&&"âœï¸ Stroke",e==="text"&&"ðŸ“ Text",e==="table"&&"ðŸ“Š Table"]},e))}),t.jsxs("div",{className:"control",children:[t.jsx("label",{children:"Ink color"}),t.jsx("input",{type:"color",value:x,onChange:e=>X(e.target.value)})]}),t.jsxs("div",{className:"control",children:[t.jsxs("label",{children:["Stroke width: ",j,"px"]}),t.jsx("input",{type:"range",min:2,max:12,value:j,onChange:e=>Q(Number(e.target.value))})]}),t.jsxs("div",{className:"control",children:[t.jsx("label",{children:"Active tool"}),t.jsx("p",{className:"active-tool",children:oe})]}),t.jsx("button",{className:"danger-btn",onClick:se,children:"Clear board"})]}),t.jsx("div",{className:"board-wrapper",children:t.jsxs("div",{ref:B,className:"board",onPointerDown:K,onPointerMove:ee,onPointerUp:te,children:[t.jsxs("svg",{className:"board-canvas",children:[f.map(e=>ne(e)),R&&C.length>1&&t.jsx("polyline",{className:"path-stroke preview",points:C.map(e=>`${e.x},${e.y}`).join(" "),stroke:x,strokeWidth:j,strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})]}),c&&t.jsx("input",{ref:D,type:"text",className:"board-text-input",value:c.value,onChange:e=>v({...c,value:e.target.value}),onKeyDown:e=>{e.key==="Enter"?(e.preventDefault(),N(c.value,c.position)):e.key==="Escape"&&(e.preventDefault(),S())},onBlur:()=>{c.value.trim()?N(c.value,c.position):S()},style:{left:`${c.position.x}px`,top:`${c.position.y}px`,color:x},placeholder:"Type text here..."})]})}),t.jsxs("aside",{className:"panel history-panel",children:[t.jsxs("div",{className:"history-header",children:[t.jsxs("div",{children:[t.jsx("p",{className:"panel-title",children:"History"}),t.jsx("p",{className:"history-meta",children:u.length?`${u.length} events`:"No activity"})]}),t.jsx("button",{className:"ghost-btn",onClick:()=>window.alert("Open this dashboard in another tab to collaborate in real-time!"),children:"Invite"})]}),t.jsx("ul",{className:"history-list",children:u.map(e=>t.jsxs("li",{className:"history-row",children:[t.jsxs("div",{className:"history-content",children:[t.jsx("p",{className:"history-description",children:e.description}),t.jsx("p",{className:"history-user",children:e.user})]}),t.jsxs("div",{className:"history-actions",children:[t.jsx("span",{className:"history-time",children:ce(e.timestamp)}),t.jsx("button",{className:"history-delete-btn",onClick:()=>re(e.id),"aria-label":`Remove ${e.description}`,title:"Remove this action",children:"Ã—"})]})]},e.id))})]})]})]})}const xe=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"}));export{de as A,ue as T,xe as a,t as j};
